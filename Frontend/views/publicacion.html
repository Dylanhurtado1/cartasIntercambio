<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Visualizar Publicación</title>
  <link rel="stylesheet" href="/public/css/menu.css">
  <link rel="stylesheet" href="/public/css/publicacion.css">
</head>
<body>
  <header id="menu-app"></header>

  <div id="app"> 
    <!-- VISTA DE LA PUBLICACIÓN -->
  
    <main v-if="publicacion" class="detalle-publicacion" v-cloak>
      <div class="carta-ofrecida">
        <div class="info-principal">
          <h2>{{ publicacion.cartaOfrecida.nombre }}</h2>
          <h3><strong>Juego:</strong> {{ publicacion.cartaOfrecida.juego }}</h3>
          <p><strong>Descripción:</strong> {{ publicacion.descripcion }}</p>
          <div class="imagenes">
            <img v-for="(img, idx) in publicacion.cartaOfrecida.imagenes" :key="idx" :src="`${img}`" alt="Imagen carta ofrecida" />
          </div>
        </div>
        <div class="info-secundaria">
          <p><strong>Estado:</strong> {{ publicacion.cartaOfrecida.estado }}</p>
          <p><strong>Fecha:</strong> {{ formatearFecha(publicacion.fecha) }}</p>
          <p v-if="publicacion.precio"><strong>Precio:</strong> ${{ publicacion.precio }}</p>
          <p><strong>Estado:</strong> <span :class="publicacion.estado == 'ACTIVA' ? 'activo' : 'finalizado'">{{ publicacion.estado }}</span></p>
          <a class="btn-principal" :href="'/publicacion/' + publicacion.id + '/ofertas'" >Ver ofertas</a>
        </div>
      </div>
    
      <hr>
  
      <div v-if="publicacion.cartasInteres && publicacion.cartasInteres.length" class="cartas-interes">
        <h3>Cartas de interés</h3>
          <div class="carta" v-for="(carta, i) in publicacion.cartasInteres" :key="i">
            <p>Nombre de la carta: <strong>{{ carta.nombre }}</strong> </p>
            <p>Juego: {{ carta.juego }}</p>
            <p>Estado: {{ carta.estado }}</p>
            <div class="imagenes">
              <img v-for="(img, j) in carta.imagenes" :key="j" :src="`/uploads/${img}`" alt="Imagen carta interés" />
            </div>
          </div>
      </div>
    </main>

    <div v-else class="cargando">
      Cargando publicación...
    </div> 
    
    <!-- VISTA DE UNA OFERTA -->

    <form v-if="formVisible" @submit.prevent="submitForm" class="formulario-oferta">
      <div class="grupo-form">
        <label for="price"><strong>Precio a ofertar: ($)</strong></label>
        <input
          type="number"
          v-model="price"
          id="price"
          placeholder="Ej: 100"
          class="input-text"
        />
      </div>
    
      <div v-for="(card, index) in cards" :key="index" class="carta-ofrecida">
        <h3>Carta {{ index + 1 }}</h3>
        <div class="grupo-form">
          <label for="name"><strong>Nombre:</strong></label>
          <input type="text" v-model="card.nombre" id="name" placeholder="Nombre" class="input-text" />
        </div>
    
        <div class="grupo-form">
          <label for="game"><strong>Juego:</strong></label>
          <input type="text" v-model="card.juego" id="game" placeholder="Juego" class="input-text"/>
        </div>
    
        <div class="grupo-form">
          <label for="estado"><strong>Estado:</strong></label>
          <select v-model="card.estado" id="state" class="input-text">
            <option value="NUEVO">NUEVO</option>
            <option value="MUY_BUENO">MUY BUENO</option>
            <option value="BUENO">BUENO</option>
            <option value="MALO">MALO</option>
            <option value="MUY_MALO">MUY MALO</option>
          </select>
        </div>
    
        <div class="grupo-form">
          <label for="image"><strong>Imagen:</strong></label>
          <input type="file" @change="handleFileChange(index, $event)" id="image" multiple accept="image/*" required />
        </div>
    
        <!-- <div v-if="card.image" class="vista-previa">
          <img :src="card.image" alt="Imagen de la carta" />
        </div> -->

        <button type="button" class="btn-secundario" @click="deleteCard(index)">Eliminar</button>
      </div>
    
      <button type="button" @click="addCard" class="btn-secundario">Añadir una carta</button>
      <button type="submit" class="btn-principal">Enviar Oferta</button>
    </form>
  </div>
  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="/public/js/publicacion.js"></script>
  <script src="/public/js/menu.js"></script>

</body>
</html>
